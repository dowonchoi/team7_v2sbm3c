<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">
<div th:fragment="navbarFragment">
  <!-- ✅ 상단 유틸 메뉴 -->
  <div class="top-util d-flex justify-content-between px-4 py-1 bg-white border-bottom small text-secondary" style="font-size: 13px;">
    <div>
<<<<<<< HEAD
      <a href="http://localhost:3003/seller-guide" class="me-3 text-decoration-none text-secondary" target="_blank">판매자센터</a>
=======
      <a href="http://localhost:3000/seller-guide" class="me-3 text-decoration-none text-secondary" target="_blank">판매자센터</a>
>>>>>>> b08a8f6a3f0fcb573949aeae4219bef14823f306
      <a th:href="@{/notice/list}" class="me-3 text-decoration-none text-secondary">공지사항</a>
      <!-- ✅ 관리자 전용 MMS 메뉴 -->
      <th:block th:if="${session.gradeStr eq 'admin'}">
          <a th:href="@{/mms/tool}" class="me-3 text-decoration-none text-danger fw-bold">MMS 문자 전송</a>
      </th:block>



    </div>
    
    <div>
      <th:block th:if="${session.memberno == null}">
        <a th:href="@{/member/create}" class="me-3 text-decoration-none text-secondary">회원가입</a>
        <a th:href="@{/member/login}" class="me-3 text-decoration-none text-secondary">로그인</a>
      </th:block>
      <th:block th:if="${session.memberno != null}">
        <a th:href="@{/member/mypage}" class="me-3 text-dark text-decoration-none" th:text="${session.mname + ' 님'}"></a>
        <a th:href="@{/member/logout}" class="me-3 text-decoration-none text-secondary">로그아웃</a>
      </th:block>
      <a th:href="@{/inquiry/list_by_member}" 
       class="text-decoration-none fw-bold" 
       style="color: #4aad2c;">1:1 문의하기</a>
    </div>
  </div>

  <!-- ✅ 메인 네비게이션 -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm sticky-top">
    <div class="container-fluid">

      <!-- ✅ 로고 (좌측 상단) -->
      <a th:href="@{/}" class="navbar-brand d-flex align-items-center" style="height: 60px; margin-right: 12px;">
        <img th:src="@{/images/SoOn.png}" alt="SoOn 마켓"
            style="height: 100%; width: auto; object-fit: contain; display: block;">
      </a>

      <!-- 전체카테고리 드롭다운 -->
      <div class="dropdown">
        <a class="btn btn-link text-dark fw-bold dropdown-toggle me-3" href="#" id="dropdownCategory" data-bs-toggle="dropdown" aria-expanded="false" style="text-decoration: none;">
          <i class="bi bi-list"></i> 전체카테고리
        </a>
        <ul class="dropdown-menu" aria-labelledby="dropdownCategory">
          <li th:each="cateVOMenu : ${menu}">
            <div class="dropdown-header fw-bold ps-3" th:text="${cateVOMenu.grp}">카테고리그룹</div>
            <ul class="list-unstyled ps-2" th:if="${cateVOMenu != null and cateVOMenu.list_name != null}">
              <li th:each="cateVO : ${cateVOMenu.list_name}">
                <a class="dropdown-item ps-4" th:href="@{|/products/list_by_cateno_grid?cateno=${cateVO.cateno}|}" th:text="${cateVO.name}">카테고리</a>
              </li>
            </ul>
            <hr class="dropdown-divider" />
          </li>
        </ul>
      </div>

      <!-- 메인 메뉴 -->
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link fw-bold" th:href="@{/}">홈</a></li>
        <li class="nav-item"><a class="nav-link fw-bold" th:href="@{/products/best}">베스트</a></li>
        <li class="nav-item"><a class="nav-link fw-bold" th:href="@{/products/new}">NEW</a></li>
        <li class="nav-item"><a class="nav-link fw-bold" th:href="@{/products/soon_expire}">임박특가</a></li>
        <li class="nav-item"><a class="nav-link fw-bold" th:href="@{/products/event}">기획전</a></li>
      </ul>

      <!-- ✅ 검색창: 아이콘으로 제출 -->
      <form class="position-relative me-4" th:action="@{/products/search}" method="get" style="max-width: 400px; width: 100%;">
        <input class="form-control pe-5" type="search" name="keyword" placeholder="검색어를 입력해 주세요" aria-label="Search">
        
        <!-- 🔍 검색 아이콘 -->
        <button type="submit" class="position-absolute top-50 end-0 translate-middle-y me-2 border-0 bg-transparent">
          <i class="bi bi-search" style="font-size: 18px; color: #888;"></i>
        </button>
      </form>


      <!-- 아이콘 영역 -->
      <div class="d-flex align-items-center">
        <th:block th:if="${session.memberno != null}">
          <a href="#" class="me-3 text-dark position-relative" onclick="toggleNotificationPopup()">
            <i class="bi bi-bell" style="font-size: 22px;"></i>
            <span id="notificationCount" class="badge bg-danger position-absolute top-0 start-100 translate-middle" style="display:none; font-size: 10px;">0</span>
          </a>
          <a th:href="@{/member/mypage}" class="me-3 text-dark"><i class="bi bi-person" style="font-size: 22px;"></i></a>
          <!-- <a th:href="@{/cart/list}" class="text-dark"><i class="bi bi-cart" style="font-size: 22px;"></i></a> -->
          <!-- <a th:href="@{/cart/list}" class="text-dark position-relative">
              <i class="bi bi-cart" style="font-size: 22px;"></i>
              <span class="navbar-cart-badge" th:if="${cartCount > 0}" th:text="${cartCount}"></span>
          </a> -->
          <a th:href="@{/cart/list}" class="text-dark position-relative" style="display: inline-block;">
              <i class="bi bi-cart" style="font-size: 22px;"></i>
              <!-- ✅ 장바구니 개수 뱃지 -->
              <span id="cart-count" class="navbar-cart-badge" style="display: none;">0</span>
          </a>



        </th:block>
      </div>
    </div>
  </nav>

  <!-- ✅ 알림 팝업 스크립트 -->
  <script>
    function toggleNotificationPopup() {
      const container = document.querySelector('.bi-bell').closest('a');
      let popup = document.querySelector('#notificationPopup');

      if (!popup) {
        popup = document.createElement('div');
        popup.id = 'notificationPopup';
        popup.classList.add('notification-popup');
        popup.style.position = 'absolute';
        popup.style.top = '60px';
        popup.style.right = '40px';
        popup.style.backgroundColor = '#fff7d6';
        popup.style.width = '320px';
        popup.style.borderRadius = '12px';
        popup.style.boxShadow = '0 8px 20px rgba(0, 0, 0, 0.5)';
        popup.style.padding = '20px';
        popup.style.zIndex = '9999';
        popup.style.overflow = 'auto';
        popup.style.maxHeight = '400px';
        document.body.appendChild(popup);
      }

      if (popup.style.display === 'block') {
        popup.style.display = 'none';
      } else {
        popup.innerHTML = '';

        const closeBtn = document.createElement('span');
        closeBtn.innerHTML = '&times;';
        closeBtn.style.position = 'absolute';
        closeBtn.style.top = '6px';
        closeBtn.style.right = '10px';
        closeBtn.style.cursor = 'pointer';
        closeBtn.style.fontSize = '32px';
        closeBtn.style.fontWeight = 'bold';
        closeBtn.style.color = '#333';
        closeBtn.onclick = () => popup.style.display = 'none';
        popup.appendChild(closeBtn);

        fetch('/notification/list_popup')
          .then(response => response.text())
          .then(html => {
            const content = document.createElement('div');
            content.innerHTML = html;
            popup.appendChild(content);
          });

        popup.style.display = 'block';
      }
    }

    fetch('/notification/count')
      .then(response => response.text())
      .then(count => {
        const badge = document.getElementById('notificationCount');
        if (parseInt(count) > 0) {
          badge.textContent = count;
          badge.style.display = 'inline-block';
        } else {
          badge.style.display = 'none';
        }
      });

      document.addEventListener("DOMContentLoaded", function() {
          fetch("/cart/count")
              .then(response => response.text())
              .then(count => {
                  const badge = document.getElementById("cart-count");
                  if (parseInt(count) > 0) {
                      badge.textContent = count;
                      badge.style.display = "inline-block"; // 보이게
                  } else {
                      badge.style.display = "none"; // 0이면 숨김
                  }
              })
              .catch(error => console.error("장바구니 개수 로딩 실패:", error));
      });
      
  </script>
</div>
</html>