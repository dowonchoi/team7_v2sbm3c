<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">
<div th:fragment="navbarFragment">
  <!-- âœ… ìƒë‹¨ ìœ í‹¸ ë©”ë‰´ -->
  <div class="top-util d-flex justify-content-between px-4 py-1 bg-white border-bottom small text-secondary" style="font-size: 13px;">
    <div>
      <a class="me-3 text-decoration-none text-secondary">íŒë§¤ìì„¼í„°</a>
      <a th:href="@{/notice/list}" class="me-3 text-decoration-none text-secondary">ê³µì§€ì‚¬í•­</a>
    </div>
    <div>
      <th:block th:if="${session.memberno == null}">
        <a th:href="@{/member/create}" class="me-3 text-decoration-none text-secondary">íšŒì›ê°€ì…</a>
        <a th:href="@{/member/login}" class="me-3 text-decoration-none text-secondary">ë¡œê·¸ì¸</a>
      </th:block>
      <th:block th:if="${session.memberno != null}">
        <a th:href="@{/member/mypage}" class="me-3 text-dark text-decoration-none" th:text="${session.mname + ' ë‹˜'}"></a>
        <a th:href="@{/member/logout}" class="me-3 text-decoration-none text-secondary">ë¡œê·¸ì•„ì›ƒ</a>
      </th:block>
      <a th:href="@{/inquiry/list_by_member}" class="text-decoration-none text-primary fw-bold">1:1 ë¬¸ì˜í•˜ê¸°</a>
    </div>
  </div>

  <!-- âœ… ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm sticky-top">
    <div class="container-fluid">

      <!-- âœ… ë¡œê³  (ì¢Œì¸¡ ìƒë‹¨) -->
      <a th:href="@{/}" class="navbar-brand d-flex align-items-center" style="height: 60px; margin-right: 12px;">
        <img th:src="@{/images/SoOn.png}" alt="SoOn ë§ˆì¼“"
            style="height: 100%; width: auto; object-fit: contain; display: block;">
      </a>

      <!-- ì „ì²´ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ -->
      <div class="dropdown">
        <a class="btn btn-link text-dark fw-bold dropdown-toggle me-3" href="#" id="dropdownCategory" data-bs-toggle="dropdown" aria-expanded="false" style="text-decoration: none;">
          <i class="bi bi-list"></i> ì „ì²´ì¹´í…Œê³ ë¦¬
        </a>
        <ul class="dropdown-menu" aria-labelledby="dropdownCategory">
          <li th:each="cateVOMenu : ${menu}">
            <div class="dropdown-header fw-bold ps-3" th:text="${cateVOMenu.grp}">ì¹´í…Œê³ ë¦¬ê·¸ë£¹</div>
            <ul class="list-unstyled ps-2" th:if="${cateVOMenu != null and cateVOMenu.list_name != null}">
              <li th:each="cateVO : ${cateVOMenu.list_name}">
                <a class="dropdown-item ps-4" th:href="@{|/products/list_by_cateno_grid?cateno=${cateVO.cateno}|}" th:text="${cateVO.name}">ì¹´í…Œê³ ë¦¬</a>
              </li>
            </ul>
            <hr class="dropdown-divider" />
          </li>
        </ul>
      </div>

      <!-- ë©”ì¸ ë©”ë‰´ -->
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link fw-bold" th:href="@{/}">í™ˆ</a></li>
        <li class="nav-item"><a class="nav-link fw-bold" th:href="@{/products/best}">ë² ìŠ¤íŠ¸</a></li>
        <li class="nav-item"><a class="nav-link fw-bold" th:href="@{/products/new}">NEW</a></li>
        <li class="nav-item"><a class="nav-link fw-bold" th:href="@{/products/soon_expire}">ì„ë°•íŠ¹ê°€</a></li>
        <li class="nav-item"><a class="nav-link fw-bold" th:href="@{/products/event}">ê¸°íšì „</a></li>
      </ul>

      <!-- âœ… ê²€ìƒ‰ì°½: ì•„ì´ì½˜ìœ¼ë¡œ ì œì¶œ -->
      <form class="position-relative me-4" th:action="@{/products/search}" method="get" style="max-width: 400px; width: 100%;">
        <input class="form-control pe-5" type="search" name="keyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”" aria-label="Search">
        
        <!-- ğŸ” ê²€ìƒ‰ ì•„ì´ì½˜ -->
        <button type="submit" class="position-absolute top-50 end-0 translate-middle-y me-2 border-0 bg-transparent">
          <i class="bi bi-search" style="font-size: 18px; color: #888;"></i>
        </button>
      </form>


      <!-- ì•„ì´ì½˜ ì˜ì—­ -->
      <div class="d-flex align-items-center">
        <th:block th:if="${session.memberno != null}">
          <a href="#" class="me-3 text-dark position-relative" onclick="toggleNotificationPopup()">
            <i class="bi bi-bell" style="font-size: 22px;"></i>
            <span id="notificationCount" class="badge bg-danger position-absolute top-0 start-100 translate-middle" style="display:none; font-size: 10px;">0</span>
          </a>
          <a th:href="@{/member/mypage}" class="me-3 text-dark"><i class="bi bi-person" style="font-size: 22px;"></i></a>
          <a th:href="@{/cart/list}" class="text-dark"><i class="bi bi-cart" style="font-size: 22px;"></i></a>
        </th:block>
      </div>
    </div>
  </nav>

  <!-- âœ… ì•Œë¦¼ íŒì—… ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    function toggleNotificationPopup() {
      const container = document.querySelector('.bi-bell').closest('a');
      let popup = document.querySelector('#notificationPopup');

      if (!popup) {
        popup = document.createElement('div');
        popup.id = 'notificationPopup';
        popup.classList.add('notification-popup');
        popup.style.position = 'absolute';
        popup.style.top = '60px';
        popup.style.right = '40px';
        popup.style.backgroundColor = '#fff7d6';
        popup.style.width = '320px';
        popup.style.borderRadius = '12px';
        popup.style.boxShadow = '0 8px 20px rgba(0, 0, 0, 0.5)';
        popup.style.padding = '20px';
        popup.style.zIndex = '9999';
        popup.style.overflow = 'auto';
        popup.style.maxHeight = '400px';
        document.body.appendChild(popup);
      }

      if (popup.style.display === 'block') {
        popup.style.display = 'none';
      } else {
        popup.innerHTML = '';

        const closeBtn = document.createElement('span');
        closeBtn.innerHTML = '&times;';
        closeBtn.style.position = 'absolute';
        closeBtn.style.top = '6px';
        closeBtn.style.right = '10px';
        closeBtn.style.cursor = 'pointer';
        closeBtn.style.fontSize = '32px';
        closeBtn.style.fontWeight = 'bold';
        closeBtn.style.color = '#333';
        closeBtn.onclick = () => popup.style.display = 'none';
        popup.appendChild(closeBtn);

        fetch('/notification/list_popup')
          .then(response => response.text())
          .then(html => {
            const content = document.createElement('div');
            content.innerHTML = html;
            popup.appendChild(content);
          });

        popup.style.display = 'block';
      }
    }

    fetch('/notification/count')
      .then(response => response.text())
      .then(count => {
        const badge = document.getElementById('notificationCount');
        if (parseInt(count) > 0) {
          badge.textContent = count;
          badge.style.display = 'inline-block';
        } else {
          badge.style.display = 'none';
        }
      });
  </script>
</div>
</html>
