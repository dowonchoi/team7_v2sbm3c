<!DOCTYPE html>
<html layout:decorate="~{layout}">
<div layout:fragment="content">
  <div class="title_line">회원 탈퇴</div>

  <form th:action="@{/member/delete}" method="post" onsubmit="return confirmDelete();">
    <!-- memberno를 hidden으로 전송 -->
    <input type="hidden" th:name="memberno" th:value="${memberVO.memberno}" />

    <div class="form-group">
      <label>비밀번호 확인</label>
      <input type="password" name="passwd" class="form-control" required />
    </div>

    <div class="form-group mt-3">
      <button type="submit" class="btn btn-danger">회원 탈퇴</button>
      <a th:href="@{/member/mypage}" class="btn btn-secondary">취소</a>
    </div>
  </form>

  <script>
  function deleteMember() {
    if (!confirm("정말 탈퇴하시겠습니까?")) return false;

    const memberno = document.getElementById("memberno").value;
    const passwd = document.getElementById("passwd").value;

    fetch("/member/delete", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `memberno=${memberno}&passwd=${passwd}`
    })
    .then(res => res.text())
    .then(result => {
      if (result.trim() === "success") {
        alert("회원 탈퇴가 완료되었습니다.");
        location.href = "/member/login";
      } else {
        alert("비밀번호가 일치하지 않거나 탈퇴에 실패했습니다.");
      }
    });

    return false; // form submit 막기
  }
</script>
</div>
</html>
