<!DOCTYPE html>
<html layout:decorate="~{layout}">
<div layout:fragment="content">

  <div class='title_line'>íšŒì›(ê´€ë¦¬ì ì „ìš©)</div>

  <aside class="aside_right">
    <a href="javascript:location.reload();">ìƒˆë¡œê³ ì¹¨</a>
    <!-- <span class='menu_divide'>â”‚</span>
    <a href='./create'>íšŒì› ê°€ì…</a> -->
    <span class='menu_divide'>â”‚</span>
    <a href='./list'>ëª©ë¡</a>
    <span class='menu_divide'>â”‚</span>
    <a href="./admin/pending_suppliers">ìŠ¹ì¸ ëŒ€ê¸° ê³µê¸‰ì</a>
    <span href='menu_divide'>|</span>
    <a href="./withdrawn_list">íƒˆí‡´ íšŒì› ëª©ë¡</a>
  </aside>

  <div class='menu_line'></div>

  <!-- ğŸ” ê²€ìƒ‰ì°½ -->
  <div style="text-align: right; margin-bottom: 10px;">
    <form method="get" action="/member/list_search" style="display: inline-flex; gap: 6px;">
      <input type="text" name="word" th:value="${word}" placeholder="ê²€ìƒ‰"
            style="padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px;">

      <button type="submit" class="btn btn-secondary btn-sm">ê²€ìƒ‰</button>

      <span th:if="${word != null and word != ''}">
        <button type="button" class="btn btn-outline-secondary btn-sm"
                onclick="location.href='/member/list'">ê²€ìƒ‰ ì·¨ì†Œ</button>
      </span>
    </form>
  </div>

  <table class="table table-striped" style='width: 100%;'>
    <colgroup>
      <col style='width: 5%;'/>
      <col style='width: 10%;'/>
      <col style='width: 13%;'/>
      <col style='width: 15%;'/>
      <col style='width: 18%;'/>
      <col style='width: 10%;'/>
      <col style='width: 10%;'/>
      <col style='width: 8%;'/>
    </colgroup>
    <tr>
      <th class='th_bs'> </th>
      <th class='th_bs'>ID</th>
      <th class='th_bs'>ì„±ëª…</th>
      <th class='th_bs'>ì „í™”ë²ˆí˜¸</th>
      <th class='th_bs'>ì£¼ì†Œ</th>
      <th class='th_bs'>ë“±ë¡ì¼</th>
      <th class='th_bs'>ìŠ¹ì¸ ìƒíƒœ</th>
      <th class='th_bs'>ë“±ê¸‰</th>
      <th class='th_bs'>ê´€ë¦¬</th>
    </tr>

    <tr th:each="memberVO : ${list}">
      <td class='td_basic'>
        <div>
          <div th:if="${memberVO.grade >= 1 and memberVO.grade <= 4}">
            <img src='/member/images/admin.png' title="ê´€ë¦¬ì" class="icon">
          </div>
          <div th:if="${memberVO.grade >= 5 and memberVO.grade <= 15}">
            <img src='/member/images/member.jpg' title="ê³µê¸‰ì" class="icon">
          </div>
          <div th:if="${memberVO.grade >= 16 and memberVO.grade <= 39}">
            <img src='/member/images/user.png' title="ì†Œë¹„ì" class="icon">
          </div>
          <div th:if="${memberVO.grade >= 40 and memberVO.grade <= 49}">
            <img src='/member/images/x.png' title="íƒˆí‡´ íšŒì›" class="icon">
          </div>
        </div>
      </td>
      <td class='td_left'><a th:href="@{|./read?memberno=${memberVO.memberno}|}" th:text="${memberVO.id}"></a></td>
      <td class='td_left'><a th:href="@{|./read?memberno=${memberVO.memberno}|}" th:text="${memberVO.mname}"></a></td>
      <td class='td_basic' th:text="${memberVO.tel}"></td>
      <td class='td_left'>
        <span th:if="${memberVO.address1.length() > 15}" th:text="|${memberVO.address1.substring(0, 15)}...|"></span>
        <span th:unless="${memberVO.address1.length() > 15}" th:text="${memberVO.address1}"></span>
      </td>
      <td class='td_basic' th:text="${memberVO.mdate.substring(0, 10)}"></td>
      <td class='td_basic' style="text-align: center;">
        <span th:if="${memberVO.grade >= 5 and memberVO.grade <= 15}">
          <span th:if="${memberVO.supplier_approved == 'Y'}" style="color:green; font-weight:bold;">ìŠ¹ì¸</span>
          <span th:if="${memberVO.supplier_approved == 'N'}" style="color:red; font-weight:bold;">ë¯¸ìŠ¹ì¸</span>
        </span>
        <span th:unless="${memberVO.grade >= 5 and memberVO.grade <= 15}">-</span>
      </td>
      <td class='td_basic' th:text="${memberVO.grade}"></td>
      <td class='td_basic'>
        <!-- ê´€ë¦¬ìë§Œ ì‚­ì œ ë²„íŠ¼ í‘œì‹œ -->
        <div th:if="${session.grade == 'admin'}">
          <button type="button" class="btn btn-danger btn-sm"
                  th:onclick="|deleteMember(${memberVO.memberno})|">ì‚­ì œ</button>
        </div>
      </td>
    </tr>
  </table>

  <div class='bottom_menu'>
    <button type='button' onclick="location.reload();" class="btn btn-primary btn-sm">ìƒˆë¡œ ê³ ì¹¨</button>
  </div>

  <script>
    function deleteMember(memberno) {
      if (confirm("ì •ë§ ì´ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        fetch("/member/delete_by_admin", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          body: "memberno=" + memberno
        })
        .then(response => response.text())
        .then(result => {
          if (result.trim() === "success") {
            alert("íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.reload();
          } else if (result.trim() === "unauthorized") {
            alert("ê´€ë¦¬ìë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
          } else {
            alert("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        })
        .catch(error => {
          alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error);
        });
      }
    }
  </script>

</div>
</html>