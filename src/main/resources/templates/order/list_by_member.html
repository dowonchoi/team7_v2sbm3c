<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">
<div layout:fragment="content">

  <h2>내 주문 목록</h2>

  <!-- 주문이 없을 경우 메시지 출력 -->
  <div th:if="${#lists.isEmpty(orderList)}">
    <p>주문 내역이 없습니다.</p>
  </div>

  <!-- 주문 목록 전체 박스 -->
  <div class="order-list-wrapper">

    <!-- 주문 카드 반복 -->
    <div th:each="order : ${orderList}" class="order-list-card">

      <!-- 주문 헤더 -->
      <div class="order-list-header">
        <div>
          <strong th:text="${#dates.format(order.rdate, 'yyyy. M. d')} + ' 주문번호 : ' + ${order.orderno}"></strong>
        </div>
        <div class="order-list-status">
          <span th:text="${order.status}">결제완료</span>
        </div>
      </div>

      <!-- 주문 항목 반복 -->
      <div th:each="item : ${order.items}" 
           th:attr="onclick=|location.href='/products/read?productsno=${item.productsno}'|"
           class="order-list-body"
           style="cursor: pointer;">

        <!-- 상품 이미지 -->
        <img th:src="@{/products/storage/{img}(img=${item.thumb1})}" alt="상품 이미지" class="order-list-thumb" />

        <!-- 상품 정보 -->
        <div class="order-list-info">
          <div class="order-list-title" th:text="${item.pname}">상품명</div>
          <div class="order-list-desc">
            <span th:text="${#numbers.formatInteger(item.saleprice, 3, 'COMMA')} + '원'"></span>
            <span th:text="'수량: ' + ${item.cnt} + '개'"></span>
          </div>

          <!-- 버튼 영역 -->
          <div class="order-list-actions">

            <!-- 🚫 배송조회: 비활성화된 버튼 -->
            <a href="#"
              onclick="event.preventDefault(); event.stopPropagation(); return false;"
              class="btn btn-sm btn-outline-primary disabled"
              style="pointer-events: none; opacity: 0.6;">
              배송조회
            </a>

            <!-- 교환/반품 신청 -->
            <a th:href="@{/cancel/create(orderno=${order.orderno})}" 
               onclick="event.stopPropagation()" 
               class="btn btn-sm btn-outline-secondary">
              교환/반품 신청
            </a>

            <!-- 리뷰 작성 -->
            <a th:href="@{/review/create(orderno=${order.orderno}, productsno=${item.productsno})}" 
               onclick="event.stopPropagation()" 
               class="btn btn-sm btn-outline-success">
              리뷰 작성하기
            </a>

            <!-- 판매자 문의 -->
            <a th:href="@{/qna/create_user(productsno=${item.productsno})}" 
               onclick="event.stopPropagation()" 
               class="btn btn-sm btn-outline-warning">
              판매자 문의
            </a>

          </div>
        </div>

      </div> <!-- end item -->

    </div> <!-- end order -->

  </div> <!-- end wrapper -->

</div>
</html>
