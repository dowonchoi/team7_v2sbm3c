<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">
<div layout:fragment="content">
<head>
  <title>Q&A 상세보기</title>
  <style>
    .qna-detail {
      max-width: 900px;
      margin: 40px auto;
      border: 1px solid #ddd;
      border-radius: 15px;
      padding: 30px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      font-family: 'Arial', sans-serif;
    }
    .qna-header {
      border-bottom: 1px solid #ddd;
      padding-bottom: 15px;
      margin-bottom: 30px;
      color: #666;
      font-size: 14px;
    }
    .qna-header span {
      margin-right: 20px;
    }
    .qna-title {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 25px;
    }
    .qna-content-box {
      border: 1px solid #ccc;
      border-radius: 15px;
      background-color: #f9f9f9;
      padding: 25px;
      font-size: 16px;
      line-height: 1.6;
      min-height: 150px;
    }
    .btn-box {
      text-align: center;
      margin-top: 30px;
    }
    .btn-box a {
      display: inline-block;
      padding: 10px 25px;
      margin: 0 10px;
      border-radius: 25px;
      background-color: #333;
      color: #fff;
      text-decoration: none;
    }
    .btn-box a:hover {
      background-color: #555;
    }
    .reply-section {
      margin-top: 40px;
      border-top: 1px solid #ddd;
      padding-top: 30px;
    }
    .reply-section h3 {
      margin-bottom: 15px;
      font-size: 18px;
    }
    .reply-content {
      border: 1px solid #ccc;
      border-radius: 15px;
      background-color: #f1f1f1;
      padding: 20px;
      font-size: 15px;
      line-height: 1.5;
    }
    .reply-writer {
      margin-top: 10px;
      text-align: right;
      font-size: 13px;
      color: #888;
    }
  </style>
</head>
<body>
  <div class="qna-detail">
    <!-- 상단 정보 -->
    <div class="qna-header">
      <span>작성자: <strong th:text="${qnaVO.writer_id}"></strong></span>
      <span>등록일: <strong th:text="${#dates.format(qnaVO.reg_date, 'yyyy-MM-dd HH:mm')}"></strong></span>
      <span>카테고리: <strong th:text="${qnaVO.cate}"></strong></span>
      <span>조회수: <strong th:text="${qnaVO.view_count}"></strong></span>
    </div>

    <!-- 제목 -->
    <div class="qna-title" th:text="${qnaVO.title}"></div>

    <!-- 내용 -->
    <div class="qna-content-box" th:text="${qnaVO.content}"></div>

    <!-- 버튼 -->
    <div class="btn-box">
      <a th:href="@{/notice/list}">목록</a>

      <!-- 소비자/공급자 본인일 경우만 수정/삭제 가능 -->
      <a th:if="${grade > 4 and id == qnaVO.writer_id}" th:href="@{'/qna/update?qna_id=' + ${qnaVO.qna_id}}">수정</a>
      <a th:if="${grade > 4 and id == qnaVO.writer_id}" th:href="@{'/qna/delete?qna_id=' + ${qnaVO.qna_id}}" onclick="return confirm('정말 삭제하시겠습니까?');">삭제</a>
    </div>

    <!-- 답변 영역 -->
    <div class="reply-section" th:if="${qnaVO.reply}">
      <h3>
        답변 │ 답변 작성자: <span th:text="${qnaVO.reply_writer} ?: '관리자'"></span>
      </h3>
      <div class="reply-content" th:text="${qnaVO.reply}"></div>
    </div>

    <!-- ✅ 관리자 답변 등록/수정/삭제 버튼 분기 -->
    <div class="btn-box" th:if="${grade >= 1 and grade <= 4}">
      
      <!-- 답변이 없는 경우 → 등록 버튼만 -->
      <a th:if="${qnaVO.reply == null or qnaVO.reply.isEmpty()}"
        th:href="@{'/qna/reply?qna_id=' + ${qnaVO.qna_id}}">
        답변 등록
      </a>

      <!-- 답변이 있는 경우 → 수정/삭제 버튼 -->
      <th:block th:if="${qnaVO.reply != null and !qnaVO.reply.isEmpty()}">
        <a th:href="@{'/qna/reply?qna_id=' + ${qnaVO.qna_id}}">답변 수정</a>
        <a th:href="@{'/qna/reply_delete?qna_id=' + ${qnaVO.qna_id}}"
          onclick="return confirm('답변을 정말 삭제하시겠습니까?');">
          답변 삭제
        </a>
      </th:block>
    </div>

  </div>
</body>
</div>
</html>
