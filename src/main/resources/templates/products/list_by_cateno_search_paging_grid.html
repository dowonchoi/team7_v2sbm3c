<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">
<div layout:fragment="content">

  <div class="title_line">
    <span th:text="${cateVO.grp}" class="title_line_text"></span>
    > <span th:text="${cateVO.name}" class="title_line_text"></span>
    <span th:if="${word != ''}" th:text="|> ${word} (${search_count} 건)|" class="title_line_text"></span>
  </div>

  <aside class="aside_right">
    <span th:if="${session.grade == 'admin' or session.grade == 'supplier'}">
      <a th:href="@{|/products/create?cateno=${cateVO.cateno}|}">등록</a>
      <span class="menu_devide">│</span>
    </span>
    <a href="javascript:location.reload();">새로고침</a>
    <span class="menu_divide">│</span>
    <a th:href="@{|./list_by_cateno_grid?cateno=${cateVO.cateno}|}">목록</a>
  </aside>

  <!-- 검색 영역 -->
  <div th:replace="~{products/list_search_com::list_search_locationfragment}"></div>

  <div class="menu_line"></div>

  <!-- ✅ 카드형 레이아웃 -->
  <div class="list-grid-container">
    
    <!-- 상품 목록 -->
    <div th:if="${list.size() > 0}" th:each="productsVO : ${list}"
         class="list-grid-card"
         th:attr="data-link=@{'/products/read'(productsno=${productsVO.productsno}, word=${word}, now_page=${now_page})}"
         onclick="navigateTo(this)">

      <!-- 이미지 -->
      <div class="list-grid-img-box">
        <img th:if="${productsVO.file1 != null and productsVO.file1 != ''}"
             th:src="@{|/products/storage/${productsVO.thumb1}|}" alt="상품 이미지">
        <img th:if="${productsVO.file1 == null or productsVO.file1 == ''}"
             src="/products/images/default_thumb.png" alt="기본 이미지">
      </div>

      <!-- 상품 제목 -->
      <div class="list-grid-title" th:text="${productsVO.title}"></div>

      <!-- 가격 & 할인 -->
      <div class="list-grid-price-box">
        <span class="list-grid-dc" th:text="${productsVO.dc + '%'}"></span>
        <span class="list-grid-saleprice"
              th:text="${#numbers.formatInteger(productsVO.saleprice, 3, 'COMMA')} + '원'"></span>
      </div>

      <!-- 포인트 -->
      <div class="list-grid-point" th:text="'포인트: ' + ${productsVO.point} + '점'"></div>

      <!-- 소비기한 -->
      <div class="list-grid-expdate">
        소비기한: <span th:text="${#dates.format(productsVO.expdate, 'yyyy.MM.dd')}"></span>
      </div>

      <!-- 무료배송 -->
      <div class="list-grid-delivery">무료배송</div>
    </div> <!-- ✅ 반복문 닫는 위치 -->

    <!-- 상품이 없을 때 -->
    <div th:if="${list.size() == 0}" class="list-grid-empty">
      관련 글이 등록되지 않았습니다.
    </div>

  </div> <!-- list-grid-container 끝 -->

  <!-- 페이지네이션 -->
  <div class="bottom_menu" th:utext="${paging}"></div>

  <!-- ✅ JS 네비게이션 -->
  <script>
    function navigateTo(element) {
      const url = element.getAttribute('data-link');
      if (url) location.href = url;
    }
  </script>

</div>
</html>
