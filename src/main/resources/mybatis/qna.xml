<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dev.mvc.qna.QnaDAOInter">
    
  <!-- 사용자 유형별 Q&A 목록 -->
  <select id="listByUserType" parameterType="string" resultType="dev.mvc.qna.QnaVO">
    SELECT qna_id, cate, title, reg_date, writer_name, comment_count, view_count
    FROM qna
    WHERE user_type = #{userType}
    ORDER BY qna_id DESC
  </select>
  
  <!-- 사용자 유형 + 카테고리별 Q&A 목록 -->
  <select id="listByUserTypeAndCate" resultType="dev.mvc.qna.QnaVO">
    SELECT qna_id, cate, title, reg_date, writer_name, comment_count, view_count
    FROM qna
    WHERE user_type = #{userType} AND cate = #{cate}
    ORDER BY qna_id DESC
  </select>
  
  <update id="increaseViewCount" parameterType="int">
    UPDATE qna SET view_count = view_count + 1 WHERE qna_id = #{qna_id}
  </update>

  <!-- Q&A 상세 조회 -->
  <select id="read" parameterType="int" resultType="dev.mvc.qna.QnaVO">
    SELECT qna_id, cate, title, content, reg_date, writer_id, writer_name, user_type, memberno, comment_count, reply, view_count, reply_writer
    FROM qna
    WHERE qna_id = #{qna_id}
  </select>
  
  <insert id="create" parameterType="dev.mvc.qna.QnaVO">
    INSERT INTO qna (qna_id, cate, title, content, writer_id, writer_name, user_type, memberno, reg_date, comment_count)
    VALUES (qna_seq.nextval, #{cate}, #{title}, #{content}, #{writer_id}, #{writer_name, jdbcType=VARCHAR}, #{user_type}, #{memberno}, SYSDATE, 0)
  </insert>
  
  <update id="update" parameterType="dev.mvc.qna.QnaVO">
    UPDATE qna
    SET cate = #{cate}, title = #{title}, content = #{content}
    WHERE qna_id = #{qna_id}
  </update>
  
  <delete id="delete" parameterType="int">
    DELETE FROM qna WHERE qna_id = #{qna_id}
  </delete>
  
  <update id="addComment" parameterType="dev.mvc.qna.QnaVO">
    UPDATE qna
    SET comment = #{comment}
    WHERE qna_id = #{qna_id}
  </update>

  <!-- ✅ 추가: 공식 답변(reply) 등록/수정 -->
  <update id="updateReply" parameterType="dev.mvc.qna.QnaVO">
    UPDATE qna
    SET reply = #{reply}, reply_writer = #{reply_writer , jdbcType=VARCHAR}
    WHERE qna_id = #{qna_id}
  </update>

  <!-- ✅ 추가: 공식 답변(reply) 조회 (별도 조회 시) -->
  <select id="getReply" parameterType="int" resultType="string">
    SELECT reply
    FROM qna
    WHERE qna_id = #{qna_id}
  </select>
  
  <!-- Q&A 문의 건수 조회 -->
  <select id="countByMember" resultType="int" parameterType="int">
    SELECT COUNT(*) FROM qna WHERE memberno = #{memberno}
  </select>

</mapper>
