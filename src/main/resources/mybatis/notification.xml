<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dev.mvc.notification.NotificationDAOInter">
  
  <!-- 1. 안 읽은 알림 개수 조회 -->
  <select id="countUnreadNotifications" resultType="int">
    SELECT COUNT(*)
    FROM notification
    WHERE memberno = #{memberno}
      AND is_read = 'N'
  </select>
  
  <!-- 2. 회원별 알림 목록 조회 (최신순) -->
  <select id="selectNotificationsByMemberId" resultType="dev.mvc.notification.NotificationVO">
    SELECT notification_id, memberno, type,message,url,is_read, created_at
    FROM notification
    WHERE memberno = #{memberno}
    ORDER BY created_at DESC
  </select>
  
  <!-- 3. 알림 읽음 처리 -->
  <update id="markNotificationAsRead">
    UPDATE notification
    SET is_read = 'Y'
    WHERE notification_id = #{notification_id}
  </update>
  
  <!-- 4. 알림 등록 -->
  <insert id="insertNotification" parameterType="dev.mvc.notification.NotificationVO">
    INSERT INTO notification (notification_id, memberno, type, message, url, is_read, created_at)
    VALUES ( notification_seq.NEXTVAL, #{memberno}, #{type}, #{message}, #{url}, #{is_read}, SYSDATE)
  </insert>
  
  <delete id="delete" parameterType="int">
    DELETE FROM notification WHERE notification_id = #{notification_id}
  </delete>


</mapper>
